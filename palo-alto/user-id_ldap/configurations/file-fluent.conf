<source>
  @type tail
  read_from_head true
  path /var/log/syslog
  pos_file /tmp/container-logs.pos
  tag ldap-access.log
  <parse>
  @type multiline
  format_firstline /\w+ \d+ \d+.\d+.\d+ [\w+|-]+ \w+\[\d+\]\: \w+ conn=\d+ fd=\d+ ACCEPT from/
  format1 /(?<timestamp>\w+ \d+ \d+.\d+.\d+) [\w+|-]+ \w+\[\d+\]\: \w+ conn=\d+ fd=\d+ ACCEPT from IP=(?<ip>\d+.\d+.\d+.\d+):\d+ \(IP=\d+.\d+.\d+.\d+:\d+\)\n/
  format2 /\w+ \d+ \d+.\d+.\d+ [\w+|-]+ \w+\[\d+\]\: \w+ conn=\d+ op=\d+ BIND dn=\"cn=(?<username>\w+),cn=(?<group>\w+),dc=\w+,dc=\w+\" method=\d+\n/
  </parse>
</source>

<match ldap-access.log>
  @type http
  endpoint http://192.168.1.213:8080/v1/datasets
  # Authorization Bearer should be an ingest token
  headers {"Authorization": "blahasd293948920adsfnjkaf"}
  json_array false
  open_timeout 3

  <format>
    @type json
  </format>

  <buffer>
    flush_interval 5s
  </buffer>
</match>

# <match ldap-access.log>
#    @type file
#    path /output/ldap-access.log
# </match>